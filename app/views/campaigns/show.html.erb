<h1>Campaigns for <em><%=h @site.name %></em></h1>
<p class="stats">This site has <%= @site.spots.count %> spots with <%= @site.campaigns_allowed %> campaigns slots.</p>

<% if @site.spots.empty? %>
  <p>You haven&rsquo;t defined any advertising spots for this site yet. You can manage the spots available in the sites section or by <%= link_to 'visiting this page', url(:controller => "sites", :action => "edit", :id => @site.id) %>.</p>
<% else %>
  <% for spot in @site.spots %>
    <h2>Spot: <em><%=h spot.name %></em></h2>
    <ul class="campaigns">
      <% for index in 1..spot.campaign_limit%>
        <li>
          <%= partial :campaign_slot, :slot_number => index, :spot => spot %>
        </li>
      <% end %>
    </ul>
  <% end %>
  <% form_for :campaign do %>
    <div class="form">
      <h2>Add a campaign</h2>
      <%= error_messages_for @campaign %>
      <dl class="form">
        <dt><label for="campaign_name">Name</label></dt>
        <dd><%= text_control :name %></dd>
      </dl>
      <dl class="form">
        <dt><label for="campaign_spot">For Spot</label></dt>
        <dd><%= select_control :spot_id, :collection => @site.spots, :text_method => :name, :value_method => :id %></dd>
      </dl>
      <dl class="form">
        <dt><label>Duration</label></dt>
        <dd>
          <input type="text" class="datepicker" update_field="campaign_starts_on" update_text="starts_on_text" /> <input type="text" class="datepicker" update_field="campaign_ends_on" update_text="ends_on_text" />
          <p class="dateresults"><strong>Start:</strong> <span id="starts_on_text" class="invalid">N/A</span> <strong>End:</strong> <span id="ends_on_text" class="invalid">N/A</span></p>
          <%= hidden_control :starts_on, :id => "campaign_starts_on" %> <%= hidden_control :ends_on, :id => "campaign_ends_on" %>
        </dd>
      </dl>
      <div class="actions"><%= submit_button "Add Campaign" %></div>
    </div>
  <% end %>
<% end %>

<% throw_content :sidebar do %>
  <h3>Manage another site</h3>
  <%= select_field :collection => @sites, :text_method => :name, :value_method => :id, :prompt => "Chose a site", :id => "site_selector" %>
<% end %>